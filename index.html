<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spending Interval Display</title>
    <style>
        body {
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: Arial, sans-serif;
            margin: 0;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
        }
        .canvas-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        #clockCanvas {
            background-color: white;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            font-size: 24px;
            margin-bottom: 20px;
        }
        h2 {
            font-size: 18px;
            margin-bottom: 10px;
        }
        #display {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
            padding: 15px;
            background-color: #e0e0e0;
            border-radius: 4px;
            min-height: 30px;
        }
        .progress-container {
            width: 100%;
            height: 20px;
            background-color: #ddd;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        .progress-bar {
            width: 0%;
            height: 100%;
            background-color: #28a745;
            transition: width 0.1s linear;
        }
        .time-display {
            text-align: center;
            font-size: 14px;
            color: #333;
            margin-bottom: 10px;
        }
        .completed-durations {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        .completed-durations ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .completed-durations li {
            margin-bottom: 5px;
        }
        .button-group {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            color: white;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        #startBtn {
            background-color: #007bff;
        }
        #startBtn:hover:not(:disabled) {
            background-color: #0056b3;
        }
        #resetBtn {
            background-color: #dc3545;
        }
        #resetBtn:hover:not(:disabled) {
            background-color: #b02a37;
        }
        #clearDataBtn {
            background-color: #fd7e14;
        }
        #clearDataBtn:hover:not(:disabled) {
            background-color: #e0a800;
        }
        #addCategoryBtn {
            background-color: #28a745;
        }
        #addCategoryBtn:hover:not(:disabled) {
            background-color: #218838;
        }
        #applyCustomBtn {
            background-color: #6f42c1;
        }
        #applyCustomBtn:hover:not(:disabled) {
            background-color: #5a32a3;
        }
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            font-size: 14px;
            margin-bottom: 5px;
        }
        .input-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .category-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .category-input input[type="text"] {
            width: 65%;
        }
        .category-input input[type="number"] {
            width: 35%;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Spending Interval Display</h1>
        
        <!-- Clock Canvas -->
        <div class="canvas-container">
            <canvas id="clockCanvas" width="300" height="300"></canvas>
        </div>
        
        <!-- Display Area -->
        <div id="display"></div>
        <div class="progress-container">
            <div id="progressBar" class="progress-bar"></div>
        </div>
        <div id="remainingTime" class="time-display"></div>
        <div id="completedDurations" class="completed-durations"></div>
        
        <!-- Controls -->
        <div class="button-group">
            <button id="startBtn">Start</button>
            <button id="resetBtn" disabled>Reset</button>
            <button id="clearDataBtn">Clear Saved Data</button>
        </div>
        
        <!-- Custom Input Section -->
        <div class="input-group">
            <h2>Custom Categories</h2>
            <div class="input-group">
                <label>Hours Worked per Week:</label>
                <input id="hoursPerWeek" type="number" min="1" value="40">
            </div>
            <div class="input-group">
                <label>Days Worked per Week:</label>
                <input id="daysPerWeek" type="number" min="1" max="7" value="5">
            </div>
            <div class="input-group">
                <label>Shift Length (hours):</label>
                <input id="shiftLength" type="number" min="0.1" step="0.1" value="8">
            </div>
            <div class="input-group">
                <label>Shift Start Time:</label>
                <input id="shiftStartTime" type="time" value="08:00">
            </div>
            <div class="input-group">
                <label>Total Monthly Budget ($):</label>
                <input id="totalBudget" type="number" min="0" step="0.01" value="1000">
            </div>
            <div id="categoryInputs">
                <div class="category-input">
                    <input type="text" placeholder="Category">
                    <input type="number" placeholder="$" min="0" step="0.01">
                </div>
            </div>
            <button id="addCategoryBtn">Add Category</button>
            <button id="applyCustomBtn">Apply Custom Categories</button>
        </div>
    </div>

    <script>
        // Default categories and their durations in hours
        const defaultCategories = [
            { name: "Housing", hours: 1.9 },
            { name: "Taxes", hours: 1.274 },
            { name: "Medical", hours: 1.072 },
            { name: "Groceries", hours: 0.813 },
            { name: "Utilities", hours: 0.568 },
            { name: "Transport", hours: 0.438 },
            { name: "Investments", hours: 0.438 },
            { name: "Shopping", hours: 0.288 },
            { name: "Services", hours: 0.72 },
            { name: "Gifts and Donations", hours: 0.086 },
            { name: "Personal Care", hours: 0.086 }
        ];

        // Array of distinct colors for category arcs
        const colors = [
            '#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF', '#00FFFF',
            '#FFA500', '#800080', '#008000', '#FFC0CB', '#A52A2A', '#40E0D0'
        ];

        let categories = [...defaultCategories];
        let currentIndex = 0;
        let timer = null;
        let progressTimer = null;
        let isRunning = false;
        let totalHoursPerDay = 0;
        let completedCategories = [];

        const display = document.getElementById('display');
        const progressBar = document.getElementById('progressBar');
        const remainingTime = document.getElementById('remainingTime');
        const completedDurations = document.getElementById('completedDurations');
        const clockCanvas = document.getElementById('clockCanvas');
        const ctx = clockCanvas.getContext('2d');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const clearDataBtn = document.getElementById('clearDataBtn');
        const addCategoryBtn = document.getElementById('addCategoryBtn');
        const applyCustomBtn = document.getElementById('applyCustomBtn');
        const hoursPerWeekInput = document.getElementById('hoursPerWeek');
        const daysPerWeekInput = document.getElementById('daysPerWeek');
        const shiftLengthInput = document.getElementById('shiftLength');
        const shiftStartTimeInput = document.getElementById('shiftStartTime');
        const totalBudgetInput = document.getElementById('totalBudget');
        const categoryInputs = document.getElementById('categoryInputs');

        // Format time in hours, minutes, seconds
        function formatTime(hours) {
            const totalSeconds = Math.floor(hours * 3600);
            const h = Math.floor(totalSeconds / 3600);
            const m = Math.floor((totalSeconds % 3600) / 60);
            const s = totalSeconds % 60;
            return `${h}h ${m}m ${s}s`;
        }

        // Calculate start angle based on shift start time
        function getStartAngle() {
            const time = shiftStartTimeInput.value; // e.g., "08:00"
            if (!time) return -Math.PI / 2; // Default to 12 o'clock if invalid
            const [hours, minutes] = time.split(':').map(Number);
            const totalHours = hours + minutes / 60; // Convert to decimal hours
            const fractionOfDay = totalHours / 24; // Proportion of 24-hour day
            // Map to radians: 0h = -90°, 24h = -90° + 2π
            return -Math.PI / 2 + fractionOfDay * 2 * Math.PI;
        }

        // Draw analog clock face (no arcs unless started)
        function drawClock(showArcs = false) {
            const centerX = clockCanvas.width / 2;
            const centerY = clockCanvas.height / 2;
            const radius = Math.min(centerX, centerY) * 0.8;
            const shiftLength = Math.max(parseFloat(shiftLengthInput.value) || 8, 0.1); // Ensure positive

            // Clear canvas
            ctx.clearRect(0, 0, clockCanvas.width, clockCanvas.height);

            // Draw clock face
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Draw hour markers
            for (let i = 0; i < 12; i++) {
                const angle = (i * 30 - 90) * Math.PI / 180; // 12 at top
                const markerRadius = radius * 0.9;
                const x1 = centerX + markerRadius * Math.cos(angle);
                const y1 = centerY + markerRadius * Math.sin(angle);
                const x2 = centerX + radius * Math.cos(angle);
                const y2 = centerY + radius * Math.sin(angle);
                ctx.beginPath();
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 1;
                ctx.stroke();

                // Draw hour numbers
                const textRadius = radius * 0.75;
                const textX = centerX + textRadius * Math.cos(angle);
                const textY = centerY + textRadius * Math.sin(angle);
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillStyle = '#333';
                ctx.fillText((i === 0 ? 12 : i).toString(), textX, textY);
            }

            // Draw category arcs only if showArcs is true
            if (showArcs) {
                let startAngle = getStartAngle(); // Start at shift start time
                categories.forEach((category, index) => {
                    const hours = category.hours;
                    if (hours <= 0) return;
                    const proportion = hours / shiftLength; // Scale to shiftLength
                    const arcAngle = proportion * 2 * Math.PI;
                    const endAngle = startAngle + arcAngle;

                    // Draw arc with distinct color
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, radius * 0.5, startAngle, endAngle);
                    ctx.strokeStyle = colors[index % colors.length]; // Cycle through colors
                    ctx.lineWidth = 10;
                    ctx.stroke();

                    // Draw label
                    const labelAngle = endAngle - arcAngle / 2;
                    const labelRadius = radius * 0.65;
                    const labelX = centerX + labelRadius * Math.cos(labelAngle);
                    const labelY = centerY + labelRadius * Math.sin(labelAngle);
                    ctx.font = '10px Arial';
                    ctx.fillStyle = ctx.strokeStyle;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(category.name, labelX, labelY);

                    startAngle = endAngle;
                });
            }
        }

        // Update completed durations display
        function updateCompletedDurations() {
            if (completedCategories.length === 0) {
                completedDurations.innerHTML = '';
                return;
            }
            completedDurations.innerHTML = '<h3>Completed Durations:</h3><ul>' +
                completedCategories.map(cat => `<li>${cat.name}: ${formatTime(cat.hours)}</li>`).join('') +
                '</ul>';
        }

        // Load saved data from localStorage
        function loadSavedData() {
            const savedData = localStorage.getItem('spendingAppData');
            if (savedData) {
                const { hoursPerWeek, daysPerWeek, shiftLength, shiftStartTime, totalBudget, customCategories } = JSON.parse(savedData);
                
                // Update input fields
                hoursPerWeekInput.value = hoursPerWeek || 40;
                daysPerWeekInput.value = daysPerWeek || 5;
                shiftLengthInput.value = shiftLength || 8;
                shiftStartTimeInput.value = shiftStartTime || '08:00';
                totalBudgetInput.value = totalBudget || 1000;

                // Clear existing category inputs
                categoryInputs.innerHTML = '';

                // Load saved categories or add a default empty input
                if (customCategories && customCategories.length > 0) {
                    customCategories.forEach(category => {
                        const div = document.createElement('div');
                        div.className = 'category-input';
                        div.innerHTML = `
                            <input type="text" placeholder="Category" value="${category.name}">
                            <input type="number" placeholder="$" min="0" step="0.01" value="${category.dollars}">
                        `;
                        categoryInputs.appendChild(div);
                    });
                } else {
                    // Add a default empty input
                    const div = document.createElement('div');
                    div.className = 'category-input';
                    div.innerHTML = `
                        <input type="text" placeholder="Category">
                        <input type="number" placeholder="$" min="0" step="0.01">
                    `;
                    categoryInputs.appendChild(div);
                }
            }
            drawClock(false); // Draw only clock face
        }

        // Save data to localStorage
        function saveData() {
            const hoursPerWeek = parseFloat(hoursPerWeekInput.value) || 40;
            const daysPerWeek = parseFloat(daysPerWeekInput.value) || 5;
            const shiftLength = parseFloat(shiftLengthInput.value) || 8;
            const shiftStartTime = shiftStartTimeInput.value || '08:00';
            const totalBudget = parseFloat(totalBudgetInput.value) || 1000;
            const customCategories = [];
            
            const inputs = categoryInputs.querySelectorAll('.category-input');
            inputs.forEach(inputDiv => {
                const nameInput = inputDiv.querySelector('input[type="text"]').value.trim();
                const dollarInput = parseFloat(inputDiv.querySelector('input[type="number"]').value);
                if (nameInput && !isNaN(dollarInput) && dollarInput > 0) {
                    customCategories.push({ name: nameInput, dollars: dollarInput });
                }
            });

            const data = {
                hoursPerWeek,
                daysPerWeek,
                shiftLength,
                shiftStartTime,
                totalBudget,
                customCategories
            };
            localStorage.setItem('spendingAppData', JSON.stringify(data));
        }

        // Start the interval display
        function startIntervals() {
            if (isRunning) return;
            isRunning = true;
            startBtn.disabled = true;
            resetBtn.disabled = false;
            currentIndex = 0;
            completedCategories = [];

            // Calculate total hours per day
            const hoursPerWeek = parseFloat(hoursPerWeekInput.value) || 40;
            const daysPerWeek = parseFloat(daysPerWeekInput.value) || 5;
            totalHoursPerDay = hoursPerWeek / daysPerWeek;

            drawClock(true); // Show all arcs with distinct colors
            displayNextCategory(0);
        }

        // Display the next category with progress bar and remaining time
        function displayNextCategory(elapsedHours) {
            if (currentIndex >= categories.length || elapsedHours >= totalHoursPerDay) {
                display.textContent = "Daily work hours completed!";
                progressBar.style.width = '0%';
                remainingTime.textContent = '';
                updateCompletedDurations();
                stopIntervals();
                return;
            }

            const category = categories[currentIndex];
            const remainingHours = totalHoursPerDay - elapsedHours;
            const displayHours = Math.min(category.hours, remainingHours);

            if (displayHours <= 0) {
                currentIndex++;
                displayNextCategory(elapsedHours);
                return;
            }

            display.textContent = category.name;
            progressBar.style.width = '0%';
            remainingTime.textContent = formatTime(displayHours);

            // Start progress bar and remaining time update
            let startTime = Date.now();
            progressTimer = setInterval(() => {
                const elapsedTime = (Date.now() - startTime) / (3600 * 1000); // Convert ms to hours
                const progress = Math.min((elapsedTime / displayHours) * 100, 100);
                progressBar.style.width = `${progress}%`;
                const remaining = Math.max(displayHours - elapsedTime, 0);
                remainingTime.textContent = formatTime(remaining);
            }, 100);

            timer = setTimeout(() => {
                clearInterval(progressTimer);
                completedCategories.push({ name: category.name, hours: displayHours });
                updateCompletedDurations();
                currentIndex++;
                displayNextCategory(elapsedHours + displayHours);
            }, displayHours * 3600 * 1000); // Convert hours to milliseconds
        }

        // Stop and reset the intervals
        function stopIntervals() {
            clearTimeout(timer);
            clearInterval(progressTimer);
            isRunning = false;
            startBtn.disabled = false;
            resetBtn.disabled = true;
            display.textContent = "";
            progressBar.style.width = '0%';
            remainingTime.textContent = '';
            completedCategories = [];
            updateCompletedDurations();
            drawClock(false); // Show only clock face
            currentIndex = 0;
            totalHoursPerDay = 0;
        }

        // Clear saved data
        function clearSavedData() {
            localStorage.removeItem('spendingAppData');
            location.reload();
        }

        // Add a new category input field
        function addCategory() {
            const div = document.createElement('div');
            div.className = 'category-input';
            div.innerHTML = `
                <input type="text" placeholder="Category">
                <input type="number" placeholder="$" min="0" step="0.01">
            `;
            categoryInputs.appendChild(div);
        }

        // Apply custom categories
        function applyCustomCategories() {
            const hoursPerWeek = parseFloat(hoursPerWeekInput.value) || 40;
            const daysPerWeek = parseFloat(daysPerWeekInput.value) || 5;
            const totalBudget = parseFloat(totalBudgetInput.value) || 1000;
            const hoursPerDay = hoursPerWeek / daysPerWeek;

            const inputs = categoryInputs.querySelectorAll('.category-input');
            const customCategories = [];
            let totalDollars = 0;

            inputs.forEach(inputDiv => {
                const nameInput = inputDiv.querySelector('input[type="text"]').value.trim();
                const dollarInput = parseFloat(inputDiv.querySelector('input[type="number"]').value);
                if (nameInput && !isNaN(dollarInput) && dollarInput > 0) {
                    totalDollars += dollarInput;
                    customCategories.push({ name: nameInput, dollars: dollarInput });
                }
            });

            if (totalDollars > totalBudget) {
                alert("Total dollars exceed the total budget!");
                return;
            }

            // Convert dollars to hours based on proportion of total budget
            categories = customCategories.map(category => ({
                name: category.name,
                hours: (category.dollars / totalBudget) * hoursPerDay
            }));

            // Save to localStorage
            saveData();

            stopIntervals();
            display.textContent = "Custom categories applied! Click Start to begin.";
            drawClock(false); // Show only clock face
        }

        // Event listeners for buttons
        startBtn.addEventListener('click', startIntervals);
        resetBtn.addEventListener('click', stopIntervals);
        clearDataBtn.addEventListener('click', clearSavedData);
        addCategoryBtn.addEventListener('click', addCategory);
        applyCustomBtn.addEventListener('click', applyCustomCategories);

        // Initialize display and load saved data
        loadSavedData();
        display.textContent = "Click Start to begin!";
    </script>
</body>
</html>
